<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ZIP + Frames Extractor Ultra R√°pido</title>
<style>
body{
  background:#111;color:#fff;font-family:sans-serif;
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  height:100vh;text-align:center
}
input[type=file]{
  background:#222;border:2px dashed #555;padding:20px;border-radius:10px;
  cursor:pointer;color:#aaa;width:80%;max-width:400px;margin-bottom:10px;
}
button{
  margin-top:10px;padding:10px 25px;font-size:16px;border:none;
  border-radius:10px;background:#0a84ff;color:#fff;cursor:pointer;
  transition:.2s
}
button:hover{background:#006edc;transform:scale(1.05)}
#status{margin-top:20px;color:#0f0;font-size:15px}
</style>
</head>
<body>
  <h2>üéûÔ∏è Renombrar ZIP o Convertir MP4 en Frames</h2>
  <input type="file" id="zipInput" accept=".zip">
  <button id="processZipBtn">üì¶ Renombrar ZIP</button>
  <br>
  <input type="file" id="videoInput" accept="video/mp4">
  <button id="extractFramesBtn">üé¨ Extraer Frames (MP4 ‚Üí ZIP)</button>
  <div id="status"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script>
const status = document.getElementById('status');

// üì¶ Renombrar im√°genes dentro del ZIP
document.getElementById('processZipBtn').onclick = async ()=>{
  const file = document.getElementById('zipInput').files[0];
  if(!file){status.textContent='‚ö†Ô∏è Selecciona un archivo ZIP primero';return;}
  status.textContent='üì¶ Procesando ZIP...';
  const zip = await JSZip.loadAsync(file);
  const newZip = new JSZip();
  let i=0;
  for(const name of Object.keys(zip.files)){
    if(zip.files[name].dir) continue;
    const ext=name.split('.').pop().toLowerCase();
    if(['png','jpg','jpeg','webp','bmp','gif'].includes(ext)){
      const data=await zip.files[name].async('blob');
      newZip.file(`IMG_${i}_frame.${ext}`,data);
      i++;
    }
  }
  const blob=await newZip.generateAsync({type:'blob'});
  const a=document.createElement('a');
  a.href=URL.createObjectURL(blob);
  a.download='imagenes_renombradas.zip';
  a.click();
  status.textContent=`‚úÖ ${i} im√°genes renombradas`;
};

// üé¨ Extraer frames del MP4 r√°pidamente
document.getElementById('extractFramesBtn').onclick = async ()=>{
  const videoFile = document.getElementById('videoInput').files[0];
  if(!videoFile){status.textContent='‚ö†Ô∏è Selecciona un video MP4 primero';return;}

  status.textContent='üéûÔ∏è Analizando video...';
  const video = document.createElement('video');
  video.src = URL.createObjectURL(videoFile);
  video.muted = true;
  await video.play().catch(()=>{});
  await new Promise(r=>video.onloadeddata=r);

  const duration = video.duration;
  const width = video.videoWidth, height = video.videoHeight;
  const canvas = document.createElement('canvas');
  canvas.width = width; canvas.height = height;
  const ctx = canvas.getContext('2d');
  const zip = new JSZip();

  let frameIndex = 0;
  const start = performance.now();

  const captureFrame = async ()=>{
    ctx.drawImage(video,0,0,width,height);
    const blob = await new Promise(r=>canvas.toBlob(r,'image/png'));
    zip.file(`IMG_${frameIndex}_frame.png`, blob);
    frameIndex++;
    status.textContent=`üñºÔ∏è Capturados ${frameIndex} frames...`;
  };

  let lastTime = 0;
  const processFrame = async (now, metadata)=>{
    if(!metadata) return;
    if(metadata.mediaTime - lastTime >= 1/30){ // 30 FPS base
      await captureFrame();
      lastTime = metadata.mediaTime;
    }
    if(metadata.mediaTime < duration)
      video.requestVideoFrameCallback(processFrame);
    else finalize();
  };

  const finalize = async ()=>{
    const blobZip = await zip.generateAsync({type:'blob'});
    const a=document.createElement('a');
    a.href=URL.createObjectURL(blobZip);
    a.download='frames_extraidos.zip';
    a.click();
    const elapsed = ((performance.now()-start)/1000).toFixed(1);
    const fpsReal = frameIndex/duration;
    status.innerHTML=`‚úÖ ${frameIndex} frames extra√≠dos en ${elapsed}s<br>‚ö° Velocidad recomendada: ${fpsReal.toFixed(2)} FPS`;
  };

  video.requestVideoFrameCallback(processFrame);
};
</script>
</body>
</html>
