<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Renombrador y Extractor de Frames</title>
<style>
body{
  background:#111;color:#fff;font-family:sans-serif;
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  height:100vh;text-align:center;overflow:hidden
}
h2{margin-bottom:20px}
input[type=file]{
  background:#222;border:2px dashed #555;padding:20px;border-radius:10px;
  cursor:pointer;color:#aaa;width:80%;max-width:400px;margin-bottom:15px;
  transition:.3s
}
input[type=file]:hover{border-color:#0a84ff;color:#fff}
button{
  margin-top:10px;padding:10px 25px;font-size:16px;border:none;
  border-radius:10px;background:#0a84ff;color:#fff;cursor:pointer;
  transition:.2s
}
button:hover{background:#006edc;transform:scale(1.05)}
#status{margin-top:20px;color:#0f0}
</style>
</head>
<body>
  <h2>üéûÔ∏è Renombrar o convertir a Frames</h2>
  <input type="file" id="zipInput" accept=".zip">
  <button id="processZipBtn">üì¶ Renombrar ZIP</button>
  <br>
  <input type="file" id="videoInput" accept="video/mp4">
  <button id="extractFramesBtn">üé¨ Convertir MP4 en Frames ZIP</button>
  <div id="status"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script>
const zipInput = document.getElementById('zipInput');
const videoInput = document.getElementById('videoInput');
const processZipBtn = document.getElementById('processZipBtn');
const extractFramesBtn = document.getElementById('extractFramesBtn');
const status = document.getElementById('status');

// üì¶ --- PROCESAR ZIP ---
processZipBtn.onclick = async ()=>{
  const file = zipInput.files[0];
  if(!file){status.textContent='‚ö†Ô∏è Selecciona un archivo ZIP primero';return;}
  status.textContent='üì¶ Procesando ZIP...';
  const zip = await JSZip.loadAsync(file);
  const newZip = new JSZip();
  let i=0;
  const entries = Object.keys(zip.files).filter(f=>!zip.files[f].dir);
  for(const name of entries){
    const ext=name.split('.').pop().toLowerCase();
    if(['png','jpg','jpeg','webp','bmp','gif'].includes(ext)){
      const data=await zip.files[name].async('blob');
      newZip.file(`IMG_${i}_frame.${ext}`,data);
      i++;
    }
  }
  const blob=await newZip.generateAsync({type:'blob'});
  const url=URL.createObjectURL(blob);
  const a=document.createElement('a');
  a.href=url;a.download='imagenes_renombradas.zip';a.click();
  URL.revokeObjectURL(url);
  status.textContent=`‚úÖ Renombradas ${i} im√°genes`;
};

// üé¨ --- CONVERTIR MP4 A FRAMES ---
extractFramesBtn.onclick = async ()=>{
  const videoFile = videoInput.files[0];
  if(!videoFile){status.textContent='‚ö†Ô∏è Selecciona un video MP4 primero';return;}
  status.textContent='üéûÔ∏è Extrayendo frames... esto puede tardar un poco';

  const video = document.createElement('video');
  video.src = URL.createObjectURL(videoFile);
  await video.play().catch(()=>{});
  await new Promise(res=>video.onloadedmetadata=res);
  
  const duration = video.duration;
  const fps = 30; // velocidad base recomendada
  const frameCount = Math.floor(duration * fps);
  const canvas = document.createElement('canvas');
  const ctx = canvas.getContext('2d');
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  
  const zip = new JSZip();
  let index = 0;

  for(let t=0;t<duration;t+=1/fps){
    video.currentTime = t;
    await new Promise(r=>video.onseeked=r);
    ctx.drawImage(video,0,0,canvas.width,canvas.height);
    const blob = await new Promise(r=>canvas.toBlob(r,'image/png'));
    zip.file(`IMG_${index}_frame.png`,blob);
    index++;
    status.textContent=`üñºÔ∏è Capturando frame ${index}/${frameCount}`;
  }

  const blobZip = await zip.generateAsync({type:'blob'});
  const url = URL.createObjectURL(blobZip);
  const a = document.createElement('a');
  a.href=url;a.download='frames_extraidos.zip';a.click();
  URL.revokeObjectURL(url);

  const recFPS = fps;
  status.innerHTML=`‚úÖ ${index} frames extra√≠dos<br>‚ö° Velocidad recomendada: ${recFPS} FPS para reproducir igual que el video original`;
};
</script>
</body>
</html>
